<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C16PG7FFD3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-C16PG7FFD3');
    </script>
    <title>MXON</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/png" href="https://flagcdn.com/32x24/fr.png">
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input[type="number"] {
            font-size: 16px !important;
        }
        
        body {
            -webkit-overflow-scrolling: touch;
            overflow-x: hidden;
        }
        
        input:focus {
            font-size: 16px !important;
        }

        /* Supprimer les flèches des inputs number */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
            appearance: textfield;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useCallback } = React;

        const Trophy = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                <path d="M4 22h16"></path>
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
            </svg>
        );

        const Flag = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                <line x1="4" y1="22" x2="4" y2="15"></line>
            </svg>
        );

        const Flame = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path>
            </svg>
        );

        const PencilIcon = ({ className = "w-4 h-4" }) => (
            <svg 
              className={className}
              viewBox="0 0 24 24" 
              fill="none" 
              stroke="currentColor" 
              strokeWidth="2" 
              strokeLinecap="round" 
              strokeLinejoin="round"
            >
              <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
            </svg>
        );

        const RaceInput = ({ value, onChange, isPire, className }) => {
          const [tempValue, setTempValue] = useState(value);

          useEffect(() => {
            setTempValue(value);
          }, [value]);

          return (
            <input
              type="number"
              inputMode="numeric"
              value={tempValue ?? ''}
              onChange={(e) => setTempValue(e.target.value)}
              onBlur={() => {
                if (tempValue !== value) {
                  onChange(tempValue);
                }
              }}
              onKeyDown={(e) => {
                if (e.key === 'Enter') {
                  e.target.blur();
                }
              }}
              className={className}
            />
          );
        };

        const donneesInitiales = [
            { equipe: 'FRANCE', pilote: 'ROMAIN FEBVRE', race1: null, race2: null, race3: null },
            { equipe: 'FRANCE', pilote: 'MATHIS VALIN', race1: null, race2: null, race3: null },
            { equipe: 'FRANCE', pilote: 'MAXIME RENAUX', race1: null, race2: null, race3: null },
            { equipe: 'AUSTRALIE', pilote: 'JETT LAWRENCE', race1: null, race2: null, race3: null },
            { equipe: 'AUSTRALIE', pilote: 'KYLE WEBSTER', race1: null, race2: null, race3: null },
            { equipe: 'AUSTRALIE', pilote: 'HUNTER LAWRENCE', race1: null, race2: null, race3: null },
            { equipe: 'USA', pilote: 'ELI TOMAC', race1: null, race2: null, race3: null },
            { equipe: 'USA', pilote: 'JUSTIN COOPER', race1: null, race2: null, race3: null },
            { equipe: 'USA', pilote: 'RJ HAMPSHIRE', race1: null, race2: null, race3: null },
            { equipe: 'BELGIQUE', pilote: 'LUCAS COENEN', race1: null, race2: null, race3: null },
            { equipe: 'BELGIQUE', pilote: 'SACHA COENEN', race1: null, race2: null, race3: null },
            { equipe: 'BELGIQUE', pilote: 'LIAM EVERTS', race1: null, race2: null, race3: null },
            { equipe: 'PAYS-BAS', pilote: 'GLENN COLDENHOFF', race1: null, race2: null, race3: null },
            { equipe: 'PAYS-BAS', pilote: 'KEY DE WOLF', race1: null, race2: null, race3: null },
            { equipe: 'PAYS-BAS', pilote: 'CALVIN VLAANDEREN', race1: null, race2: null, race3: null },
        ];

        const defaultFlagUrls = {
          'FRANCE': 'https://flagcdn.com/w640/fr.png',
          'AUSTRALIE': 'https://flagcdn.com/w640/au.png',
          'USA': 'https://flagcdn.com/w640/us.png',
          'BELGIQUE': 'https://flagcdn.com/w640/be.png',
          'PAYS-BAS': 'https://flagcdn.com/w640/nl.png'
        };

        const TableauClassement = () => {
          const [donnees, setDonnees] = useState(() => {
            const stored = localStorage.getItem('mxNationsData');
            return stored ? JSON.parse(stored) : donneesInitiales;
          });
          
          const [tempScores, setTempScores] = useState({});
          const [ignorePireScore, setIgnorePireScore] = useState(() => {
            const stored = localStorage.getItem('mxNationsIgnorePireScore');
            return stored ? JSON.parse(stored) : false;
          });
          const [editMode, setEditMode] = useState({});
          const [editValues, setEditValues] = useState({});
          const [flagUrls, setFlagUrls] = useState(() => {
            const stored = localStorage.getItem('mxNationsFlagUrls');
            return stored ? JSON.parse(stored) : defaultFlagUrls;
          });

          const toggleEdit = useCallback((type, id) => {
            setEditMode(prev => {
              const key = `${type}_${id}`;
              const newState = {};
              if (!prev[key]) {
                Object.keys(prev).forEach(k => newState[k] = false);
              }
              newState[key] = !prev[key];
              return newState;
            });
            setEditValues(prev => {
              const key = `${type}_${id}`;
              if (prev[key]) {
                const { [key]: _, ...rest } = prev;
                return rest;
              }
              return prev;
            });
          }, []);

          const calculerTotalEquipe = useCallback((equipe) => {
            const pilotesEquipe = donnees.filter(d => d.equipe === equipe);
            
            const tousResultats = [];
            pilotesEquipe.forEach(pilote => {
              if (pilote.race1 !== null) tousResultats.push({ valeur: pilote.race1, pilote: pilote.pilote, race: 'race1' });
              if (pilote.race2 !== null) tousResultats.push({ valeur: pilote.race2, pilote: pilote.pilote, race: 'race2' });
              if (pilote.race3 !== null) tousResultats.push({ valeur: pilote.race3, pilote: pilote.pilote, race: 'race3' });
            });
            
            const sommeTotal = tousResultats.reduce((sum, r) => sum + r.valeur, 0);
            
            // Ne retirer le pire résultat que si le système n'est pas désactivé et qu'il y a au moins 2 résultats
            let pireResultat = 0;
            let infoPireResultat = null;
            
            if (!ignorePireScore && tousResultats.length >= 2) {
              pireResultat = Math.max(...tousResultats.map(r => r.valeur));
              infoPireResultat = tousResultats.find(r => r.valeur === pireResultat);
            }
            
            return { 
              total: sommeTotal - pireResultat, 
              pire: pireResultat, 
              infoPire: infoPireResultat
            };
          }, [donnees, ignorePireScore]);

          const equipesTriees = useMemo(() => {
            const equipes = [...new Set(donnees.map(d => d.equipe))];
            return equipes.sort((a, b) => {
              const totalA = calculerTotalEquipe(a).total;
              const totalB = calculerTotalEquipe(b).total;
              if (totalA === 0 && totalB === 0) return 0;
              if (totalA === 0) return 1;
              if (totalB === 0) return -1;
              return totalA - totalB;
            });
          }, [donnees, calculerTotalEquipe]);

          const modifierValeur = useCallback((index, champ, valeur) => {
            setDonnees(prev => {
              const nouvelles = [...prev];
              if (champ === 'equipe' || champ === 'pilote') {
                nouvelles[index][champ] = valeur;
              } else {
                nouvelles[index][champ] = valeur === '' ? null : parseInt(valeur);
              }
              localStorage.setItem('mxNationsData', JSON.stringify(nouvelles));
              return nouvelles;
            });
          }, []);

          const reinitialiserScores = useCallback(() => {
            if (confirm('Êtes-vous sûr de vouloir réinitialiser tous les scores des courses ?')) {
              setDonnees(prev => {
                const nouvelles = prev.map(d => ({
                  ...d,
                  race1: null,
                  race2: null,
                  race3: null
                }));
                localStorage.setItem('mxNationsData', JSON.stringify(nouvelles));
                return nouvelles;
              });
            }
          }, []);

          const reinitialiserTout = useCallback(() => {
            if (confirm('Êtes-vous sûr de vouloir réinitialiser toutes les équipes et les scores ?')) {
              setDonnees(donneesInitiales);
              setFlagUrls(defaultFlagUrls);
              localStorage.removeItem('mxNationsData');
              localStorage.removeItem('mxNationsFlagUrls');
            }
          }, []);

          const getPodiumColor = (position) => {
            switch(position) {
              case 0: return 'from-yellow-400 via-yellow-500 to-yellow-600';
              case 1: return 'from-gray-300 via-gray-400 to-gray-500';
              case 2: return 'from-orange-400 via-orange-500 to-orange-600';
              default: return 'from-red-600 via-red-700 to-red-800';
            }
          };

          const getPodiumIcon = (position) => {
            const sizes = ['w-6 h-6 md:w-8 md:h-8', 'w-5 h-5 md:w-7 md:h-7', 'w-5 h-5 md:w-6 md:h-6', 'w-4 h-4 md:w-5 md:h-5'];
            return position < 3 ? <Trophy className={sizes[position]} /> : <Flag className={sizes[3]} />;
          };

          const getTotalPilote = useCallback((pilote) => {
            const races = [pilote.race1, pilote.race2, pilote.race3].filter(r => r !== null);
            return races.reduce((sum, r) => sum + r, 0);
          }, []);

          const estCelluleBloquee = useCallback((piloteIndex, race) => {
            const position = piloteIndex % 3; // Position dans l'équipe (0, 1, ou 2)
            
            switch (position) {
              case 0: // Premier pilote
                return race === 'race2'; // Bloquer race 2
              case 1: // Deuxième pilote
                return race === 'race3'; // Bloquer race 3
              case 2: // Troisième pilote
                return race === 'race1'; // Bloquer race 1
              default:
                return false;
            }
          }, []);

          return (
            <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black p-2 sm:p-4 md:p-6">
              <div className="text-center mb-4 sm:mb-6 md:mb-8 relative">
                <div className="absolute inset-0 bg-gradient-to-r from-red-600 via-orange-500 to-yellow-500 opacity-20 blur-3xl"></div>
                <div className="relative">
                  <div className="flex items-center justify-center gap-2 sm:gap-3 mb-1 sm:mb-2">
                    <Flame className="w-6 h-6 sm:w-8 sm:h-8 md:w-10 md:h-10 text-orange-500 animate-pulse" />
                    <h1 className="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-500 via-red-500 to-yellow-500 tracking-wider uppercase">
                      MX Nations
                    </h1>
                    <Flame className="w-6 h-6 sm:w-8 sm:h-8 md:w-10 md:h-10 text-orange-500 animate-pulse" />
                  </div>
                  <div className="fixed bottom-3 right-3 sm:bottom-4 sm:right-4 z-50 flex gap-2">
                    <button
                      onClick={reinitialiserScores}
                      className="group overflow-hidden rounded-full w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-r from-orange-500 to-yellow-600 text-white hover:shadow-xl transform transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50 shadow-lg flex items-center justify-center"
                      title="Réinitialiser les scores"
                      aria-label="Réinitialiser les scores"
                    >
                      <svg className="w-5 h-5 sm:w-6 sm:h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M3 12h18"/>
                      </svg>
                    </button>
                    <button
                      onClick={reinitialiserTout}
                      className="group overflow-hidden rounded-full w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-r from-red-600 to-red-700 text-white hover:shadow-xl transform transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 shadow-lg flex items-center justify-center"
                      title="Réinitialiser tout"
                      aria-label="Réinitialiser tout"
                    >
                    <svg 
                      className="w-5 h-5 sm:w-6 sm:h-6" 
                      viewBox="0 0 24 24" 
                      fill="none" 
                      stroke="currentColor" 
                      strokeWidth="2" 
                      strokeLinecap="round" 
                      strokeLinejoin="round"
                    >
                      <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                      <path d="M3 3v5h5"></path>
                      <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74"></path>
                    </svg>
                    <div className="absolute inset-0 bg-gradient-to-r from-yellow-600 via-orange-600 to-red-600 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-full"></div>
                  </button>
                </div>
                </div>
              </div>

              <div className="mb-6 sm:mb-8 md:mb-10">
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 max-w-6xl mx-auto h-full">
                  {equipesTriees.map((equipe, index) => {
                    const stats = calculerTotalEquipe(equipe);
                    const flagUrl = flagUrls[equipe];
                    const editKey = `flag_${equipe}`;
                    
                    return (
                      <div 
                        key={equipe} 
                        className={`relative overflow-hidden rounded-lg sm:rounded-xl bg-gradient-to-br ${getPodiumColor(index)} p-1 shadow-2xl`}
                        style={{ height: '184px' }}
                      >
                        <div className="bg-gray-900 rounded-lg p-4 sm:p-6 h-full relative overflow-hidden group">
                          <button
                            onClick={() => toggleEdit('flag', equipe)}
                            className="absolute top-2 right-2 z-30 p-1 text-gray-400 hover:text-orange-500 transition-colors opacity-0 group-hover:opacity-100"
                            title="Modifier le drapeau"
                            aria-label="Modifier le drapeau"
                          >
                            <PencilIcon className="w-4 h-4" />
                          </button>
                          <div 
                            className="absolute inset-0 opacity-30"
                            style={{
                              backgroundImage: `url(${editMode[editKey] ? (editValues[editKey] || flagUrl) : flagUrl})`,
                              backgroundSize: '100% 100%',
                              backgroundPosition: 'center',
                              backgroundRepeat: 'no-repeat'
                            }}
                          ></div>
                          {editMode[editKey] && (
                            <div className="absolute inset-x-4 top-4 z-20">
                              <input
                                type="text"
                                value={editValues[editKey] || flagUrl}
                                onChange={(e) => setEditValues(prev => ({ ...prev, [editKey]: e.target.value }))}
                                onKeyDown={(e) => {
                                  if (e.key === 'Enter') {
                                    const newUrl = editValues[editKey] || flagUrl;
                                    const updated = { ...flagUrls, [equipe]: newUrl };
                                    setFlagUrls(updated);
                                    localStorage.setItem('mxNationsFlagUrls', JSON.stringify(updated));
                                    setEditValues(prev => {
                                      const { [editKey]: _, ...rest } = prev;
                                      return rest;
                                    });
                                    toggleEdit('flag', equipe);
                                  } else if (e.key === 'Escape') {
                                    setEditValues(prev => {
                                      const { [editKey]: _, ...rest } = prev;
                                      return rest;
                                    });
                                    toggleEdit('flag', equipe);
                                  }
                                  e.stopPropagation();
                                }}
                                className="w-full bg-gray-800 px-2 py-1 rounded text-white text-sm border border-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50"
                                placeholder="URL du drapeau..."
                                autoFocus
                              />
                            </div>
                          )}
                          <div className="relative z-10">
                            <div className="flex items-center justify-between mb-2 sm:mb-3">
                              <div className="flex items-center gap-2 sm:gap-3">
                                <div className="text-white">
                                  {getPodiumIcon(index)}
                                </div>
                                <span className="text-3xl sm:text-4xl md:text-5xl font-black text-white">#{index + 1}</span>
                              </div>
                              <div className="text-right">
                                <div className="text-2xl sm:text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500">
                                  {stats.total}
                                </div>
                                <div className="text-xs text-gray-400 uppercase font-bold">Points</div>
                              </div>
                            </div>
                            <h3 className="text-lg sm:text-xl md:text-2xl font-black text-white uppercase tracking-wide">{equipe}</h3>
                            {stats.pire > 0 && (
                              <div className="mt-1 sm:mt-2 text-xs sm:text-sm text-red-400 font-bold">
                                Pire retiré: -{stats.pire}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>

              <div className="max-w-7xl mx-auto">
                <div className="mb-4 flex justify-end">
                  <button
                    onClick={() => {
                      const nouvelleEquipe = {
                        nom: 'NOUVELLE ÉQUIPE',
                        pilotes: [
                          { pilote: 'PILOTE 1', race1: null, race2: null, race3: null },
                          { pilote: 'PILOTE 2', race1: null, race2: null, race3: null },
                          { pilote: 'PILOTE 3', race1: null, race2: null, race3: null }
                        ]
                      };
                      
                      const nouvellesDonnees = [
                        ...donnees,
                        ...nouvelleEquipe.pilotes.map(p => ({
                          equipe: nouvelleEquipe.nom,
                          pilote: p.pilote,
                          race1: p.race1,
                          race2: p.race2,
                          race3: p.race3
                        }))
                      ];
                      
                      const nouveauxDrapeaux = {
                        ...flagUrls,
                        [nouvelleEquipe.nom]: 'https://flagcdn.com/w640/xx.png' // Drapeau par défaut
                      };
                      
                      setDonnees(nouvellesDonnees);
                      setFlagUrls(nouveauxDrapeaux);
                      localStorage.setItem('mxNationsData', JSON.stringify(nouvellesDonnees));
                      localStorage.setItem('mxNationsFlagUrls', JSON.stringify(nouveauxDrapeaux));
                    }}
                    className="px-4 py-2 bg-gradient-to-r from-orange-500 to-red-600 text-white font-bold rounded-lg hover:from-orange-600 hover:to-red-700 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50 uppercase tracking-wider text-sm flex items-center gap-2"
                  >
                    <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <line x1="12" y1="5" x2="12" y2="19" />
                      <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                    Ajouter une équipe
                  </button>
                </div>
                <div className="overflow-x-auto rounded-lg sm:rounded-xl md:rounded-2xl shadow-2xl">
                  <table className="w-full border-collapse bg-gray-800 text-xs sm:text-sm">
                    <thead>
                      <tr className="bg-gradient-to-r from-red-600 via-orange-600 to-yellow-600">
                        <th className="border-2 border-gray-700 px-2 sm:px-3 md:px-4 py-2 sm:py-3 md:py-4 text-left font-black text-white uppercase tracking-wide">Équipe</th>
                        <th className="border-2 border-gray-700 px-2 sm:px-3 md:px-4 py-2 sm:py-3 md:py-4 text-left font-black text-white uppercase tracking-wide">Pilote</th>
                        <th className="border-2 border-gray-700 px-1 sm:px-2 md:px-4 py-2 sm:py-3 md:py-4 text-center font-black text-white uppercase">Race 1</th>
                        <th className="border-2 border-gray-700 px-1 sm:px-2 md:px-4 py-2 sm:py-3 md:py-4 text-center font-black text-white uppercase">Race 2</th>
                        <th className="border-2 border-gray-700 px-1 sm:px-2 md:px-4 py-2 sm:py-3 md:py-4 text-center font-black text-white uppercase">Race 3</th>
                        <th className="border-2 border-gray-700 px-1 sm:px-2 md:px-4 py-2 sm:py-3 md:py-4 text-center font-black uppercase">
                          <button
                            onClick={() => {
                              setIgnorePireScore(prev => {
                                const newValue = !prev;
                                localStorage.setItem('mxNationsIgnorePireScore', JSON.stringify(newValue));
                                return newValue;
                              });
                            }}
                            className={`w-full text-center transition-colors duration-200 flex items-center justify-center gap-1 ${ignorePireScore ? 'text-red-500 hover:text-red-400' : 'text-white hover:text-orange-400'}`}
                            title={ignorePireScore ? 'Activer le retrait du pire score' : 'Désactiver le retrait du pire score'}
                          >
                            <span>Pire</span>
                            {ignorePireScore && (
                              <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                              </svg>
                            )}
                          </button>
                        </th>
                        <th className="border-2 border-gray-700 px-1 sm:px-2 md:px-4 py-2 sm:py-3 md:py-4 text-center font-black text-white uppercase">total</th>
                        <th className="border-2 border-gray-700 px-2 sm:px-3 md:px-4 py-2 sm:py-3 md:py-4 text-center font-black text-yellow-300 uppercase bg-gradient-to-r from-yellow-700 to-orange-700">score</th>
                      </tr>
                    </thead>
                    <tbody>
                      {equipesTriees.map((equipe, equipeIndex) => {
                        const pilotsEquipe = donnees
                          .map((d, originalIndex) => ({ ...d, originalIndex }))
                          .filter(d => d.equipe === equipe);
                        const stats = calculerTotalEquipe(equipe);
                        const infoPire = stats.infoPire;
                        
                        return pilotsEquipe.map((pilote, piloteIndex) => {
                          const estPireRace1 = infoPire?.pilote === pilote.pilote && infoPire?.race === 'race1';
                          const estPireRace2 = infoPire?.pilote === pilote.pilote && infoPire?.race === 'race2';
                          const estPireRace3 = infoPire?.pilote === pilote.pilote && infoPire?.race === 'race3';
                          
                          return (
                            <tr 
                              key={pilote.originalIndex} 
                              className={equipeIndex % 2 === 0 ? 'bg-gray-900' : 'bg-gray-800'}
                            >
                              {piloteIndex === 0 && (
                                <td 
                                  rowSpan={pilotsEquipe.length} 
                                  className="border-2 border-gray-700 px-2 sm:px-3 md:px-4 py-2 sm:py-3"
                                >
                                  <div className="relative group">
                                    <button
                                      onClick={() => toggleEdit('equipe', equipe)}
                                      className="absolute -left-6 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-orange-500 transition-colors opacity-0 group-hover:opacity-100"
                                      aria-label="Modifier l'équipe"
                                    >
                                      <PencilIcon />
                                    </button>
                                    {editMode[`equipe_${equipe}`] ? (
                                      <div className="flex items-center space-x-2">
                                        <input
                                          type="text"
                                          value={editValues[`equipe_${equipe}`] || equipe}
                                          onChange={(e) => setEditValues(prev => ({ ...prev, [`equipe_${equipe}`]: e.target.value }))}
                                          onKeyDown={(e) => {
                                            if (e.key === 'Enter') {
                                              const nouvelleEquipe = e.target.value.toUpperCase();
                                              const nouvelles = donnees.map(d => 
                                                d.equipe === equipe ? { ...d, equipe: nouvelleEquipe } : d
                                              );
                                              setDonnees(nouvelles);
                                              localStorage.setItem('mxNationsData', JSON.stringify(nouvelles));
                                              setEditValues(prev => {
                                                const { [`equipe_${equipe}`]: _, ...rest } = prev;
                                                return rest;
                                              });
                                              toggleEdit('equipe', equipe);
                                            } else if (e.key === 'Escape') {
                                              setEditValues(prev => {
                                                const { [`equipe_${equipe}`]: _, ...rest } = prev;
                                                return rest;
                                              });
                                              toggleEdit('equipe', equipe);
                                            }
                                            e.stopPropagation();
                                          }}
                                          autoFocus
                                          className="flex-1 bg-gray-800 px-2 py-1 rounded-l font-black text-base sm:text-lg md:text-2xl text-orange-400 caret-orange-500 uppercase focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50"
                                        />
                                        <button
                                          onClick={() => {
                                            const nouvelleEquipe = (editValues[`equipe_${equipe}`] || equipe).toUpperCase();
                                            if (nouvelleEquipe !== equipe) {
                                              const nouvelles = donnees.map(d => 
                                                d.equipe === equipe ? { ...d, equipe: nouvelleEquipe } : d
                                              );
                                              setDonnees(nouvelles);
                                              localStorage.setItem('mxNationsData', JSON.stringify(nouvelles));
                                            }
                                            setEditValues(prev => {
                                              const { [`equipe_${equipe}`]: _, ...rest } = prev;
                                              return rest;
                                            });
                                            toggleEdit('equipe', equipe);
                                          }}
                                          className="bg-gray-800 text-green-500 hover:text-green-400 px-2 py-1 rounded-r border-l-2 border-gray-700"
                                          title="Valider (ou appuyez sur Entrée)"
                                          aria-label="Valider"
                                        >
                                          <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                            <polyline points="20 6 9 17 4 12" />
                                          </svg>
                                        </button>
                                      </div>
                                    ) : (
                                      <div className="w-full font-black text-base sm:text-lg md:text-2xl text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-red-500 uppercase">
                                        {equipe}
                                      </div>
                                    )}
                                  </div>
                                </td>
                              )}
                              <td className="border-2 border-gray-700 px-2 sm:px-3 md:px-4 py-1 sm:py-2">
                                <div className="relative group">
                                  <button
                                    onClick={() => toggleEdit('pilote', pilote.originalIndex)}
                                    className="absolute -left-6 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-orange-500 transition-colors opacity-0 group-hover:opacity-100"
                                    aria-label="Modifier le pilote"
                                  >
                                    <PencilIcon />
                                  </button>
                                  {editMode[`pilote_${pilote.originalIndex}`] ? (
                                    <input
                                      type="text"
                                      value={pilote.pilote}
                                      onChange={(e) => modifierValeur(pilote.originalIndex, 'pilote', e.target.value)}
                                      onKeyDown={(e) => {
                                        if (e.key === 'Enter') {
                                          toggleEdit('pilote', pilote.originalIndex);
                                        } else if (e.key === 'Escape') {
                                          toggleEdit('pilote', pilote.originalIndex);
                                        }
                                      }}
                                      autoFocus
                                      className="w-full bg-gray-800 px-2 py-1 rounded text-white font-bold uppercase text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50"
                                    />
                                  ) : (
                                    <div className="w-full text-white font-bold uppercase text-xs sm:text-sm">
                                      {pilote.pilote}
                                    </div>
                                  )}
                                </div>
                              </td>
                              <td className={`border-2 border-gray-700 px-1 py-1 sm:py-2 ${estPireRace1 ? 'bg-red-900 bg-opacity-50' : ''}`}>
                                {estCelluleBloquee(pilote.originalIndex, 'race1') ? (
                                  <div className="w-8 sm:w-full h-8 sm:h-10 bg-gray-600 rounded-md sm:rounded-lg opacity-50 flex items-center justify-center">
                                    <svg className="w-4 h-4 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                    </svg>
                                  </div>
                                ) : (
                                  <input
                                    type="number"
                                    inputMode="numeric"
                                    value={tempScores[`${pilote.originalIndex}_race1`] ?? pilote.race1 ?? ''}
                                    onChange={(e) => setTempScores(prev => ({ ...prev, [`${pilote.originalIndex}_race1`]: e.target.value }))}
                                    onBlur={(e) => {
                                      const value = tempScores[`${pilote.originalIndex}_race1`];
                                      if (value !== undefined) {
                                        modifierValeur(pilote.originalIndex, 'race1', value);
                                        setTempScores(prev => {
                                          const { [`${pilote.originalIndex}_race1`]: _, ...rest } = prev;
                                          return rest;
                                        });
                                      }
                                    }}
                                    onKeyDown={(e) => {
                                      if (e.key === 'Enter') {
                                        e.target.blur();
                                      }
                                    }}
                                    className={`w-8 sm:w-full text-center border-2 ${estPireRace1 ? 'border-red-500 bg-red-800' : 'border-orange-600 bg-gray-700'} text-white font-bold rounded-md sm:rounded-lg px-1 sm:px-2 py-1 sm:py-2 focus:outline-none focus:ring-2 sm:focus:ring-4 focus:ring-orange-500 focus:border-orange-400 text-sm sm:text-base md:text-lg`}
                                  />
                                )}
                              </td>
                              <td className={`border-2 border-gray-700 px-1 py-1 sm:py-2 ${estPireRace2 ? 'bg-red-900 bg-opacity-50' : ''}`}>
                                {estCelluleBloquee(pilote.originalIndex, 'race2') ? (
                                  <div className="w-8 sm:w-full h-8 sm:h-10 bg-gray-600 rounded-md sm:rounded-lg opacity-50 flex items-center justify-center">
                                    <svg className="w-4 h-4 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                    </svg>
                                  </div>
                                ) : (
                                  <input
                                    type="number"
                                    inputMode="numeric"
                                    value={tempScores[`${pilote.originalIndex}_race2`] ?? pilote.race2 ?? ''}
                                    onChange={(e) => setTempScores(prev => ({ ...prev, [`${pilote.originalIndex}_race2`]: e.target.value }))}
                                    onBlur={(e) => {
                                      const value = tempScores[`${pilote.originalIndex}_race2`];
                                      if (value !== undefined) {
                                        modifierValeur(pilote.originalIndex, 'race2', value);
                                        setTempScores(prev => {
                                          const { [`${pilote.originalIndex}_race2`]: _, ...rest } = prev;
                                          return rest;
                                        });
                                      }
                                    }}
                                    onKeyDown={(e) => {
                                      if (e.key === 'Enter') {
                                        e.target.blur();
                                      }
                                    }}
                                    className={`w-8 sm:w-full text-center border-2 ${estPireRace2 ? 'border-red-500 bg-red-800' : 'border-orange-600 bg-gray-700'} text-white font-bold rounded-md sm:rounded-lg px-1 sm:px-2 py-1 sm:py-2 focus:outline-none focus:ring-2 sm:focus:ring-4 focus:ring-orange-500 focus:border-orange-400 text-sm sm:text-base md:text-lg`}
                                  />
                                )}
                              </td>
                              <td className={`border-2 border-gray-700 px-1 py-1 sm:py-2 ${estPireRace3 ? 'bg-red-900 bg-opacity-50' : ''}`}>
                                {estCelluleBloquee(pilote.originalIndex, 'race3') ? (
                                  <div className="w-8 sm:w-full h-8 sm:h-10 bg-gray-600 rounded-md sm:rounded-lg opacity-50 flex items-center justify-center">
                                    <svg className="w-4 h-4 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                    </svg>
                                  </div>
                                ) : (
                                  <input
                                    type="number"
                                    inputMode="numeric"
                                    value={tempScores[`${pilote.originalIndex}_race3`] ?? pilote.race3 ?? ''}
                                    onChange={(e) => setTempScores(prev => ({ ...prev, [`${pilote.originalIndex}_race3`]: e.target.value }))}
                                    onBlur={(e) => {
                                      const value = tempScores[`${pilote.originalIndex}_race3`];
                                      if (value !== undefined) {
                                        modifierValeur(pilote.originalIndex, 'race3', value);
                                        setTempScores(prev => {
                                          const { [`${pilote.originalIndex}_race3`]: _, ...rest } = prev;
                                          return rest;
                                        });
                                      }
                                    }}
                                    onKeyDown={(e) => {
                                      if (e.key === 'Enter') {
                                        e.target.blur();
                                      }
                                    }}
                                    className={`w-8 sm:w-full text-center border-2 ${estPireRace3 ? 'border-red-500 bg-red-800' : 'border-orange-600 bg-gray-700'} text-white font-bold rounded-md sm:rounded-lg px-1 sm:px-2 py-1 sm:py-2 focus:outline-none focus:ring-2 sm:focus:ring-4 focus:ring-orange-500 focus:border-orange-400 text-sm sm:text-base md:text-lg`}
                                  />
                                )}
                              </td>
                              <td className={`border-2 border-gray-700 px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-center font-black text-base sm:text-lg md:text-xl ${(estPireRace1 || estPireRace2 || estPireRace3) ? 'text-red-500 bg-red-900 bg-opacity-30' : 'text-gray-600'}`}>
                                {(estPireRace1 || estPireRace2 || estPireRace3) ? stats.pire : '-'}
                              </td>
                              <td className="border-2 border-gray-700 px-1 sm:px-2 md:px-4 py-1 sm:py-2 text-center font-black text-lg sm:text-xl md:text-2xl text-yellow-400">
                                {getTotalPilote(pilote)}
                              </td>
                              {piloteIndex === 0 && (
                                <td 
                                  rowSpan={pilotsEquipe.length} 
                                  className="border-2 border-gray-700 px-2 sm:px-3 md:px-4 py-2 sm:py-3 text-center font-black text-2xl sm:text-3xl md:text-4xl bg-gradient-to-br from-yellow-600 to-orange-700 text-white"
                                >
                                  {stats.total}
                                </td>
                              )}
                            </tr>
                          );
                        });
                      })}
                    </tbody>
                  </table>
                </div>
              </div>

              <div className="text-center mt-6 sm:mt-8 md:mt-10 text-gray-500 font-bold uppercase tracking-wider text-xs sm:text-sm">
              </div>
            </div>
          );
        };

        ReactDOM.render(<TableauClassement />, document.getElementById('root'));
    </script>
</body>
</html>

